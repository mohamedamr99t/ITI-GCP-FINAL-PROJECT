# GCP ITI Project
-This project will assess your Google Cloud, Networking, DB, Development,
Terraform, Docker, and Kubernetes skills.

-You will deploy a simple Node.js web application (stateless) that
interacts with a highly available MongoDB (stateful) replicated across 3 zones
and consisting of 1 primary and 2 secondaries.

![image](https://github.com/mohamedamr99t/ITI-GCP-FINAL-PROJECT/assets/139065575/cb1c221b-0aad-4071-bf50-e970a508f975)
## TESTING THE PROJECT
https://github.com/mohamedamr99t/ITI-GCP-FINAL-PROJECT/assets/139065575/4d21be47-24ce-4283-9c90-3137f94ebe66

## Infrastructure as Code (IaC) with Terraform 
### Terraform Project Structure

![image](https://github.com/mohamedamr99t/ITI-GCP-FINAL-PROJECT/assets/139065575/34331303-050e-4122-b4e9-b9c8e626efdb)

</details>

In this structure:

- Each module `gke`, `iam`, `network`, `storage`, `compute` has its dedicated directory with essential files: `main.tf`, `output.tf`, `variables.tf`.
- `main.tf` files within each module specify resources and configurations tailored to that module.
- `output.tf` files within each module define the outputs generated by that module.
- `variables.tf` files within each module describe input variables used by that module.
- The root directory contains project-wide `main.tf` and `variables.tf` files for global configurations.
- The `terraform.tfvars` file allows you to assign values to the input variables defined in your project.

## Utilizing Google Cloud Storage for Terraform Remote State Management

In this project, I have implemented Google Cloud Storage as the remote backend for efficient Terraform state file management. This choice enhances security and optimizes infrastructure management.

![image](https://github.com/mohamedamr99t/ITI-GCP-FINAL-PROJECT/assets/139065575/f34270b2-f1d3-44dd-9ab2-a946f693d414)


# Applying Infrastructure with Terraform

Follow these steps to apply and manage your infrastructure using Terraform:

1. **Clone the Repository**: Copy the project repository to your local machine to work with the code.

       git clone https://github.com/mohamedamr99t/ITI-GCP-FINAL-PROJECT.git
   
2. **Navigate to the Project Directory**: Change your working directory to the project folder. 
  
             cd terraform 
   
3. **Initialize Terraform**: Initialize Terraform in your project directory, setting up the necessary environment.

4.          init terraform 

5. **Plan the Deployment**: Create an execution plan to preview changes that Terraform will make to your infrastructure.
  
            terraform plan 

6. **Apply the Infrastructure**: Apply the infrastructure changes as specified in your Terraform configuration, and confirm when prompted.

            terraform apply

7. **Destroy Infrastructure (Optional)**: If you wish to remove the infrastructure created by Terraform, use this command. Be cautious, as it permanently removes resources.
  
           terraform destroy 

## `my_script.sh`: VM Management and Environment Setup

Execute the `my_script.sh` script to facilitate VM management and environment setup. It automates system updates, Docker installation, and user configuration, preparing your environment for the Terraform project. After running the script, proceed with VM management tasks.

``` #!/bin/bash
sudo apt-get update -y
sudo apt-get upgrade -y
sudo apt-get install -y
sudo apt install docker.io docker docker-clean containerd docker-registry
sudo groupadd docker
sudo usermod -aG docker $USER
```

By following these steps, you can effectively work with your infrastructure as code using Terraform. For further details and advanced usage, please refer to the comprehensive Terraform documentation.

---
## Dockerization and Deployment of a Node.js Web Application with MongoDB Replication Set
After cloning *( docker-nodejsapp/mongodb-manifests )* to your machine, follow these steps : 
### üõ†Ô∏è Build a Docker image from the Dockerfile in the current directory and tag it
  This command builds a Docker image from the Dockerfile in the current directory and tags it with the specified name.
   <pre>docker build . -t us-central1-docker.pkg.dev/m-amr-project-one/cluster-storage/nodejsapp:v1      -> nodeJs app    </pre>
   <pre>docker build . -t us-central1-docker.pkg.dev/m-amr-project-one/cluster-storage/mongodb-image:v1    -> mongoDB      </pre>  

### üîë Configure Docker to use gcloud as a credential helper for the given registries
  This command configures Docker to use gcloud as a credential helper for the specified registries.
    <pre>gcloud auth configure-docker us-central1-docker.pkg.dev</pre>  

### üöÄ Push the Docker image to the specified repository on the Docker registry
  This command pushes the Docker image to the specified repository on the Docker registry. This is essentially deploying your Docker image.
   <pre>docker push us-central1-docker.pkg.dev/m-amr-project-one/cluster-storage/nodejsapp:v1      -> nodeJs app    </pre>
   <pre>docker push us-central1-docker.pkg.dev/m-amr-project-one/cluster-storage/mongodb-image:v1    -> mongoDB      </pre>  
### You can replace these examples with your actual links or information as needed in your code.
---
## Deployment of NodeJs App & MongoDB via VM 
After cloning *( mongodb-manifests )* to your machine, follow these steps : 
### By navigating the directory *( mongodb-manifests )* , you can use one command to apply Kubernetes resources defined in the directory
<pre> kubectl apply -f . </pre>
OR 
<pre>kubectl apply -f app-deployment.yaml
kubectl apply -f mongo-services.yaml
kubectl apply -f mongo-secret.yaml
kubectl apply -f mongo-statefulset.yaml</pre>
---
## MongoDB Initialization and User Creation

To set up MongoDB for your application, follow these steps:

### Initialize a MongoDB replica set named "rs0" with three members and their respective host information. This is essential for data redundancy and high availability.
### Initialize Replica Set

Run the following command to initialize a MongoDB replica set:

```shell
kubectl exec -ti mongodb-0 -- mongosh 
rs.initiate(
  {
     _id: "rs0",
     version: 1,
     members: [
        { _id: 0, host : "mongodb-0.mongodb:27017" },
        { _id: 1, host : "mongodb-1.mongodb:27017" },
        { _id: 2, host : "mongodb-2.mongodb:27017" }
     ]
  }
)
```
### Create Database User: The second command creates a database user with the username "mamr" and password "12345." This user is granted read and write access to the "test" database, allowing secure data interactions.
```
db.createUser(
         {
           user: "mamr",
           pwd: "12345",
           roles: [
             { role: "readWrite", db: "exampledb" }
           ]
         }
       );
```




